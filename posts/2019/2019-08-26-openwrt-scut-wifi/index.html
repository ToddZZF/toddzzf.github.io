<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=pragma content="no-cache"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.7.0/style.css><link rel=stylesheet href=/css/tailwindcss/output.css><link rel=stylesheet href=/css/mdstyle.css><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js></script>
<link href=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css rel=stylesheet><script id=highlightjs src=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/highlight.min.js async></script>
<script>document.getElementById("highlightjs").addEventListener("load",function(){hljs.highlightAll()})</script><title>openwrt搭建宿舍无线网 - Todd's Blog</title></head><body class="font-kai bg-neutral-50 antialiased"><header class="w-full text-gray-700 bg-white dark-mode:text-gray-200 dark-mode:bg-gray-800 shadow-sm"><div x-data="{ open: false }" class="flex flex-col max-w-screen-xl px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8"><div class="p-4 flex flex-row items-center justify-between"><a href=/ class="text-lg tracking-wider text-gray-900 uppercase rounded-lg dark-mode:text-white">Todd's Blog</a>
<button class="md:hidden rounded-lg focus:outline-none focus:drop-shadow-sm" @click="open = !open"><svg fill="currentcolor" viewBox="0 0 20 20" class="w-6 h-6"><path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4A1 1 0 013 5zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm6 5a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"/><path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414.0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button></div><nav :class="{'flex': open, 'hidden': !open}" class="flex-col flex-grow pb-4 md:pb-0 hidden md:flex md:justify-end md:flex-row"><a class="px-4 py-2 mt-2 text-sm font-semibold text-gray-900 rounded-lg dark-mode:bg-gray-700 dark-mode:hover:bg-gray-600 dark-mode:focus:bg-gray-600 dark-mode:focus:text-white dark-mode:hover:text-white dark-mode:text-gray-200 md:mt-0 hover:text-gray-900 focus:text-gray-900 hover:bg-gray-200 focus:bg-gray-200 focus:outline-none focus:shadow-outline" href=/goodstuffs/>好物</a>
<a class="px-4 py-2 mt-2 text-sm font-semibold text-gray-900 rounded-lg dark-mode:bg-gray-700 dark-mode:hover:bg-gray-600 dark-mode:focus:bg-gray-600 dark-mode:focus:text-white dark-mode:hover:text-white dark-mode:text-gray-200 md:mt-0 hover:text-gray-900 focus:text-gray-900 hover:bg-gray-200 focus:bg-gray-200 focus:outline-none focus:shadow-outline" href=/posts/>日常</a></nav></div></header><main><div class="max-w-screen-lg w-full mx-auto py-8 px-4 flex flex-col gap-4"><div class="breadcrumb w-full bg-white py-2 px-4 shadow-sm"><ul class="flex align-baseline flex-wrap"><li class="after:content-['>'] after:mr-0.5 after:text-gray-300 whitespace-nowrap"><a href=http://example.org/>主页</a></li><li class="after:content-['>'] after:mr-0.5 after:text-gray-300 whitespace-nowrap"><a href=http://example.org/posts/>日常</a></li><li class="active whitespace-nowrap"><a href=http://example.org/posts/2019/2019-08-26-openwrt-scut-wifi/>openwrt搭建宿舍无线网</a></li></ul></div><div class="w-full mx-auto py-8"><div class="text-4xl font-semibold">openwrt搭建宿舍无线网</div><div class="flex gap-2 text-sm flex-wrap"><span class=post-date>2019-08-26</span>
<a href=/posts/>📂日常</a></div></div><div class="mdstyle highlightjs"><blockquote><p>之前已经有用树莓派搭过路由器了，为了追求更快的网速，这次决定用 OpenWrt 系统的路由器来试试。</p></blockquote><h1 id=准备>准备</h1><ul><li>一台装有 OpenWrt 的路由器（任何 OpenWrt 版本都行，我买的是 NetGear 的）</li><li>校园网账号</li><li>网线</li><li>一台装有 Linux 的 x86_64 设备（电脑/虚拟机/服务器，我在教程中用的是9元的阿里云服务器，如果你都没有，可以通过E-mail：todd310378072@outlook.com 联系一下我）</li><li>ssh软件（如果没有，文末有推荐软件）</li></ul><h1 id=一点预备知识>一点预备知识</h1><h2 id=ssh>SSH</h2><p>ssh 是一种协议，我们可以通过ssh软件登录到路由器，然后通过输入命令来操作路由器。</p><h2 id=wan>WAN</h2><p>WAN，Wide Area Network的缩写，即代表广域网。通过这个连接到学校的网络。</p><h2 id=lan>LAN</h2><p>LAN，Local Area Network的缩写，即局域网。手机等通过这个连接到路由器。</p><h2 id=交叉编译>交叉编译</h2><p>交叉编译是在一个平台上生成另一个平台上的可执行代码（软件）。</p><h1 id=交叉编译and部署>交叉编译and部署</h1><p>由于 OpenWrt 路由器并没有 cmake 和 make，所以需要先在 Linux服务器上编译好后，再部署到路由器上。</p><p>先通过 ssh 连接路由器，然后输入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/openwrt_release
</span></span></code></pre></div><p>然后会显示一些信息，这是我的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>DISTRIB_ID</span><span class=o>=</span><span class=s1>&#39;OpenWrt&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_RELEASE</span><span class=o>=</span><span class=s1>&#39;18.06.1&#39;</span> <span class=c1>#重要！</span>
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_TARGET</span><span class=o>=</span><span class=s1>&#39;ar71xx/nand&#39;</span> <span class=c1>#重要！</span>
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_ARCH</span><span class=o>=</span><span class=s1>&#39;mips_24kc&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_TAINTS</span><span class=o>=</span><span class=s1>&#39;no-all&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_REVISION</span><span class=o>=</span><span class=s1>&#39;R8.1.11 By Lean&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>DISTRIB_DESCRIPTION</span><span class=o>=</span><span class=s1>&#39;OpenWrt&#39;</span>
</span></span></code></pre></div><p>如果版本不是 <code>18.06.1</code>，或者不是<code>ar71xx</code>，那你需要自行找相应的 target 来编译；如果是，ssh 切换到 Linux服务器，输入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://downloads.openwrt.org/snapshots/targets/ar71xx/generic/openwrt-sdk-ar71xx-generic_gcc-7.4.0_musl.Linux-x86_64.tar.xz
</span></span></code></pre></div><blockquote><p>注：由于 openwrt每年都会更新，所以上面那个文件不存在的话，去 <a href=https://downloads.openwrt.org>https://downloads.openwrt.org/</a> 找最新的来替换。</p></blockquote><p>下载好后，解压并进入相应目录：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tar -Jxvf openwrt-sdk-ar71xx-generic_gcc-7.4.0_musl.Linux-x86_64.tar.xz
</span></span><span class=line><span class=cl><span class=nb>cd</span> openwrt-sdk-ar71xx-generic_gcc-7.4.0_musl.Linux-x86_64
</span></span></code></pre></div><p>然后新建目录：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir package/scutclient
</span></span></code></pre></div><p>从 <a href=https://github.com/scutclient/scutclient>https://github.com/scutclient/scutclient</a> 下载仓库里面的 /openwrt/Makefile 文件（貌似只能全部下载再解压？），然后放到上面新建的目录里面。</p><p>然后运行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>make defconfig
</span></span><span class=line><span class=cl>make package/scutclient/compile <span class=nv>V</span><span class=o>=</span>s
</span></span></code></pre></div><p>如果出现错误，可能缺少什么软件（比如我是缺少一个 gawk 和 ccache），或者上面的 sdk 有错（我前几次都编译失败，换了那个 sdk 才成功），这个请自行分析错误信息来解决。</p><p>编译好后，将编译好的 ipk 文件（在 bin 文件夹里）放到openwrt路由器里，然后通过 <code>opkg install [文件]</code> 来安装。</p><h1 id=登录校园网>登录校园网</h1><p>首先需要设置好 wan ，设为静态ip，然后将“校园网-个人信息”里的那些 ip、mac、网关填上去。</p><p>将路由器插上网线，然后在 ssh 中输入下面命令连接校园网：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scutclient --username &lt;username&gt; --password &lt;password&gt;
</span></span></code></pre></div><p>上面那个大概率会出错，因为需要指定是哪个 WAN 口：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>scutclient --username &lt;username&gt; --password &lt;password&gt; -i &lt;wan&gt;
</span></span></code></pre></div><p>如果你不知道是哪个，就用 <code>ifconfig</code> 查看，然后都试一次。</p><p>如果成功的话，就可以将这个命令挂到后台：（先 ctrl + c 停止正在运行的命令）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nohup scutclient --username &lt;username&gt; --password &lt;password&gt; -i &lt;wan&gt;
</span></span></code></pre></div><p>由于每天都会断网，所以早上起来时需要重新运行这个命令。</p><h1 id=配置-wifi>配置 wifi</h1><p>这个就不用说了，wifi 名随便写，最好不要写自己宿舍号（也不要<del>像我那样</del>写其他宿舍号），担心学校有人查，如果能隐藏 wifi 就最好了。</p><h1 id=谷歌学术>谷歌学术</h1><p>淘宝店帮忙刷的openwrt 大概率会安装 Shadowsocks，比如我的就安装了 ShadowsockR Plus +。如果你的没安装，自己上网找教程。我说一下大概的配置：</p><ul><li>添加ss服务器（就填好ip、端口、密码就行），启用“TCP快速打开”和“自动切换”</li><li>客户端，主服务器就选添加的服务器，运行模式选 GFW，其余可以不变</li><li>保存并启动</li></ul><h1 id=推荐软件>推荐软件</h1><p>如果你没有 ssh，我推荐两个：</p><ul><li>手机端：ConnectBot</li><li>电脑端：MobaXterm</li></ul></div></div></main><script src=https://tokinx.github.io/lately/lately.min.js></script>
<script>window.Lately&&Lately.init({target:".post-date"})</script></body></html>