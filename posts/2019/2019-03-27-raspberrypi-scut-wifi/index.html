<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=pragma content="no-cache"><meta http-equiv=cache-control content="no-cache"><meta http-equiv=expires content="0"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.7.0/style.css><link rel=stylesheet href=/css/tailwindcss/output.css><link rel=stylesheet href=/css/mdstyle.css><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js></script>
<link href=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css rel=stylesheet><script id=highlightjs src=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/highlight.min.js async></script>
<script>document.getElementById("highlightjs").addEventListener("load",function(){hljs.highlightAll()})</script><title>Raspbian版SCUT树莓派搭建宿舍无线网 - Todd's Blog</title></head><body class="font-kai bg-neutral-50 antialiased"><header class="w-full text-gray-700 bg-white dark-mode:text-gray-200 dark-mode:bg-gray-800 shadow-sm"><div x-data="{ open: false }" class="flex flex-col max-w-screen-xl px-4 mx-auto md:items-center md:justify-between md:flex-row md:px-6 lg:px-8"><div class="p-4 flex flex-row items-center justify-between"><a href=/ class="text-lg tracking-wider text-gray-900 uppercase rounded-lg dark-mode:text-white">Todd's Blog</a>
<button class="md:hidden rounded-lg focus:outline-none focus:drop-shadow-sm" @click="open = !open"><svg fill="currentcolor" viewBox="0 0 20 20" class="w-6 h-6"><path x-show="!open" fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4A1 1 0 013 5zm0 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm6 5a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"/><path x-show="open" fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414.0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/></svg></button></div><nav :class="{'flex': open, 'hidden': !open}" class="flex-col flex-grow pb-4 md:pb-0 hidden md:flex md:justify-end md:flex-row"><a class="px-4 py-2 mt-2 text-sm font-semibold text-gray-900 rounded-lg dark-mode:bg-gray-700 dark-mode:hover:bg-gray-600 dark-mode:focus:bg-gray-600 dark-mode:focus:text-white dark-mode:hover:text-white dark-mode:text-gray-200 md:mt-0 hover:text-gray-900 focus:text-gray-900 hover:bg-gray-200 focus:bg-gray-200 focus:outline-none focus:shadow-outline" href=/goodstuffs/>好物</a>
<a class="px-4 py-2 mt-2 text-sm font-semibold text-gray-900 rounded-lg dark-mode:bg-gray-700 dark-mode:hover:bg-gray-600 dark-mode:focus:bg-gray-600 dark-mode:focus:text-white dark-mode:hover:text-white dark-mode:text-gray-200 md:mt-0 hover:text-gray-900 focus:text-gray-900 hover:bg-gray-200 focus:bg-gray-200 focus:outline-none focus:shadow-outline" href=/posts/>日常</a></nav></div></header><main><div class="max-w-screen-lg w-full mx-auto py-8 px-4 flex flex-col gap-4"><div class="breadcrumb w-full bg-white py-2 px-4 shadow-sm"><ul class="flex align-baseline flex-wrap"><li class="after:content-['>'] after:mr-0.5 after:text-gray-300 whitespace-nowrap"><a href=http://example.org/>主页</a></li><li class="after:content-['>'] after:mr-0.5 after:text-gray-300 whitespace-nowrap"><a href=http://example.org/posts/>日常</a></li><li class="active whitespace-nowrap"><a href=http://example.org/posts/2019/2019-03-27-raspberrypi-scut-wifi/>Raspbian版SCUT树莓派搭建宿舍无线网</a></li></ul></div><div class="w-full mx-auto py-8"><div class="text-4xl font-semibold">Raspbian版SCUT树莓派搭建宿舍无线网</div><div class="flex gap-2 text-sm flex-wrap"><span class=post-date>2019-03-27</span>
<a href=/posts/>📂日常</a></div></div><div class="mdstyle highlightjs"><blockquote><p>自己动手，丰衣足食。</p></blockquote><blockquote><p>  首先我要特别感谢 <a href=https://www.jianshu.com/u/e21ceff836ec>象牙塔塔主</a>，ta 的文章是我在网上查到的唯一资料，为了向 ta 致敬，我决定沿用 ta 的主标题（希望这不要被认为是蹭热度&mldr;&mldr;），并且我这篇教程只允许他转载。希望各位同学去 ta 的 <a href=https://www.jianshu.com/u/e21ceff836ec>简书</a> 关注并点赞。</p><p>  同时感谢 <a href=https://github.com/scutclient>scutclient</a>，他们才是真正的大神。</p><p>  有任何问题，请联系我：201830260422@mail.scut.edu.cn，<del>如果是小姐姐，直接加我的微信好了</del></p></blockquote><h1 id=Why>为什么“多此一举”？</h1><p>  网上已经有相关教程了：<a href=https://www.jianshu.com/p/4b8e98475aeb>SCUT树莓派宿舍搭建无线网</a>，那个教程写得很好，但我在实践的过程中遇到了问题：</p><ul><li>Ubuntu 对树莓派 3B+ 的支持不是很好，官网上提供的系统根本用不了。</li><li>Ubuntu 太过于臃肿，树莓派孱弱的性能不是很够，而且 Ubuntu 耗电貌似大一点。</li></ul><p>  于是我结合那个教程，把其中 Ubuntu 换成 Debian</p><p>  另外，如果你想用路由器，可以看我这个教程 <a href=https://toddzhoufeng.github.io/2019/08/26/openwrt-scut-wifi/>openwrt搭建宿舍无线网</a></p><h1 id=Prepare>准备</h1><ul><li>校园网账号（有线网可用，如果是黑市买的账号，要向卖家拿相关设置）</li><li>安装好 Debian 的树莓派（以及屏幕、键盘、鼠标、电源，不要用 ssh）</li><li>网线</li><li>网络（我们需要下载一些东西）</li></ul><h1 id=ConnectToSCUT>连接SCUT有线网</h1><h2 id=step-1>Step 1</h2><p>  首先安装 <code>cmake</code>，输入下面命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo apt-get install cmake
</span></span></code></pre></div><p>  按<code>Ctrl</code>+<code>Alt</code>+<code>t</code>打开命令行，<strong>依次</strong>输入以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git clone https://github.com/scutclient/scutclient.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> scutclient
</span></span><span class=line><span class=cl>mkdir build <span class=o>&amp;&amp;</span> <span class=nb>cd</span> build
</span></span><span class=line><span class=cl>sudo cmake ..
</span></span><span class=line><span class=cl>sudo make
</span></span></code></pre></div><p>  然后右键点击右上角的WiFI图标，点第一个<code>Wireless & Wired Network Setting</code>，会弹出下面界面：</p><p><img src=http://www.web3.lu/wp-content/uploads/2016/02/network_pref.jpg alt=网络设置 title=网络设置></p><p>  点击右上角的<code>wlan0</code>，换成<code>eth0</code>，对照着下面的指示填（相关信息在你注册校园网时的界面上，或微信：我的企业：华南理工大学，校园网，右下营业厅，个人信息。）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>IPv4 Address: <span class=c1>#填IP地址</span>
</span></span><span class=line><span class=cl>IPv6 Address: <span class=c1>#空</span>
</span></span><span class=line><span class=cl>Router: <span class=c1>#填网关</span>
</span></span><span class=line><span class=cl>DNS Servers: <span class=c1>#填主DNS或备DNS都行</span>
</span></span><span class=line><span class=cl>DNS Searcher: <span class=c1>#空</span>
</span></span></code></pre></div><p>  勾选上面的<code>Automatically configure empty options</code>，再点下面的<code>Apply</code>，然后关闭窗口。</p><h2 id=step-2>Step 2</h2><p>  在命令行中逐行输入（将尖角括号和里面的文字替换为相应内容）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo ifconfig eth0 down
</span></span><span class=line><span class=cl>sudo ifconfig eth0 &lt;IP地址&gt; netmask &lt;掩码&gt;
</span></span><span class=line><span class=cl>sudo ifconfig eth0 down
</span></span><span class=line><span class=cl>sudo ifconfig eth0 hw ether &lt;MAC地址&gt;
</span></span><span class=line><span class=cl>sudo route add &lt;网关&gt; dev eth0
</span></span><span class=line><span class=cl>sudo route add default gw &lt;网关&gt; eth0
</span></span><span class=line><span class=cl>sudo ifconfig eth0 up
</span></span></code></pre></div><p>  上面是针对Raspbian Buster的，如果你的是Raspbian Stretch，用下面这些：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ifconfig eth0 down
</span></span><span class=line><span class=cl>sudo ifconfig eth0 &lt;IP地址&gt; netmask &lt;掩码&gt;
</span></span><span class=line><span class=cl>sudo ifconfig eth0 hw ether &lt;MAC地址&gt;
</span></span><span class=line><span class=cl>sudo route add default gw &lt;网关&gt;
</span></span><span class=line><span class=cl>sudo ifconfig eth0 up
</span></span></code></pre></div><p>  如果没有出错（没有任何反应就是没出错），插上网线，输入以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo setsid sudo /home/pi/scutclient/build/scutclient --username &lt;SCUT账号&gt; --password &lt;SCUT密码&gt;
</span></span></code></pre></div><p>  打开树莓派的浏览器测试一下，看看能不能访问百度。如果不能，执行下面这步；如果行，请跳到下一标题。</p><h2 id=step-3>Step 3</h2><p>  执行下面的命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo chmod <span class=m>777</span> /etc
</span></span><span class=line><span class=cl>sudo chmod <span class=m>777</span> /etc/resolv.conf
</span></span></code></pre></div><p>  打开<code>/etc/resolv.conf</code>，把<code>nameserver</code>后面的数字改成<code>114.114.114.114</code>，注意<code>nameserver</code>和数字之间有一个空格。</p><p>  再看看浏览器能不能访问到百度，如果能，执行下面步骤：</p><p>  把改好的<code>/etc/resolv.conf</code>复制到桌面，然后在命令行输入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo nano /etc/rc.local
</span></span></code></pre></div><p>  然后命令行会进入编辑界面，在下面，<code>exit 0</code>这一行的前面加上一行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo cp -f /home/pi/Desktop/resolv.conf /etc/resolv.conf
</span></span></code></pre></div><p>  然后按<code>Ctrl</code>+<code>x</code>，再输入<code>y</code>，再回车。至此就完成了第一部分。</p><h1 id=CreateAP>创建热点</h1><h2 id=step-4>Step 4</h2><p>  参考了csdn上一篇<a href=https://blog.csdn.net/u014271612/article/details/53766627>博客</a></p><p>  打开命令行，<strong>依次</strong>执行下面命令。<code>#</code>开头的是注释：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#将代码copy到本地，安装</span>
</span></span><span class=line><span class=cl>git clone https://github.com/oblique/create_ap
</span></span><span class=line><span class=cl><span class=nb>cd</span> create_ap
</span></span><span class=line><span class=cl>sudo make install
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#安装依赖的库</span>
</span></span><span class=line><span class=cl>sudo apt-get install util-linux procps hostapd iproute2 iw haveged dnsmasq
</span></span></code></pre></div><p>  然后我们每次开热点，都可以用如下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo create_ap wlan0 eth0 &lt;热点名&gt; &lt;密码&gt;
</span></span></code></pre></div><p>  它有时候会提示出错，这可能是因为你的<code>wlan0</code>已经连接了WiFI，试一下把断开WiFi再执行，或者重启再执行。</p><p>  拿手机试一下能不能连接成功并上网，如果能，我们可以开始配置开机自启，如果不能，检查一下上面步骤有没有出错。实在不行请联系我。</p><h1 id=AutoStart>开机自启热点</h1><h2 id=step-5>Step 5</h2><p>  在命令行输入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo nano /etc/rc.local
</span></span></code></pre></div><p>  然后命令行会进入编辑界面，在下面，<code>exit 0</code>这一行的前面加上下面几行，<code>#</code>开头的注释可以不写：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 下面是Step 2中的代码</span>
</span></span><span class=line><span class=cl>sudo ifconfig eth0 down
</span></span><span class=line><span class=cl>sudo ifconfig eth0 &lt;IP地址&gt; netmask &lt;掩码&gt;
</span></span><span class=line><span class=cl>sudo ifconfig eth0 down
</span></span><span class=line><span class=cl>sudo ifconfig eth0 hw ether &lt;MAC地址&gt;
</span></span><span class=line><span class=cl>sudo route add &lt;网关&gt; dev eth0
</span></span><span class=line><span class=cl>sudo route add default gw &lt;网关&gt;
</span></span><span class=line><span class=cl>sudo ifconfig eth0 up
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#开机启动WiFi</span>
</span></span><span class=line><span class=cl>sudo create_ap wlan0 eth0 &lt;热点名&gt; &lt;密码&gt;
</span></span></code></pre></div><p>  如果开机没有启动WiFi，在sudo后面加个 <code>setsid</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo setsid create_ap wlan0 eth0 &lt;热点名&gt; &lt;密码&gt;
</span></span></code></pre></div><p>  用 <code>setsid</code> 命令的话，即使关闭了当前 shell 也不会终止该进程。当然也可以用 <code>nohup</code>，将输出重定向到 nohup.out 文件中。这个看个人取舍。如果你想方便调试，那就用 nohup，如果想简洁，那就用 setsid。</p><p>  这样虽然开机有 WiFi，但由于没登陆 SCUT，所以还是没网，还要输入 <code>sudo nohup sudo /home/pi/scutclient/build/scutclient --username &lt;SCUT账号> --password &lt;SCUT密码></code>。不过你可以不用连接屏幕和键盘，直接用 SSH 就行了。</p><blockquote><p>注：为什么不弄成自动登录scut呢？因为我弄的时候，scutclient 老是连不上，所以就单独拿出来弄。</p></blockquote><h1 id=防蹭网>防蹭网</h1><h2 id=step-6>Step 6</h2><p>  校园网的速度有限，估计一个宿舍4个人用是没问题的，但如果再多几个人，速度就捉急了。而且，估计宿舍里的其他人很大概率会把 WiFi 密码分享出去，所以，虽然这样有点自私，但还是加个防蹭网措施吧！就是Mac地址白名单！</p><p>  先在手机上下一个 Fing（安卓/iOS都有），然后连接你的 WiFi，点击 Fing 右上角的刷新，然后你就可以看到目前有哪些设备连接了你的 WiFi，随便点进一个设备，下方有一个“ MAC地址”，长按可以复制。将白名单设备全部连到这个 WiFi ，然后将它们的Mac地址复制下来。</p><p>  回到我们的树莓派。输入</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo nano /etc/hostapd/hostapd.accept
</span></span></code></pre></div><p>  然后将Mac地址打上去，每个Mac地址占一行。保存并退出：按<code>Ctrl+x</code>，<code>y</code>，回车。</p><p>  原来的开启热点的命令是：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo create_ap wlan0 eth0 热点名 密码
</span></span></code></pre></div><p>  换成：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo create_ap --mac-filter wlan0 eth0 热点名 密码
</span></span></code></pre></div><p>  重新启动热点即可生效。</p><p>  后期需要添加设备的话，可以先用手机或电脑开热点，把设备连接到热点，然后在手机或电脑上看Mac地址，再添加到 <code>/etc/hostapd/hostapd.accept</code>（超级麻烦，所以如果是别的宿舍来借网，我都是直接用回原来的命令开热点）</p><h1 id=优化>优化</h1><h2 id=step-7>Step 7</h2><p>  WiFi 信号在信道上传播，如果某个信道有多个 WiFi，则信号间可能会有影响。我们可以将热点换到WiFi较少的信道即可。如何查看信道呢？去应用商店搜 “ wifi 分析” ，我用的是 WiFi Analyzer（安卓）这个软件。</p><p>  修改信道的方法很简单，在启动命令中加 <code>-c 信道</code>，即：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo create_ap -c 信道 wlan0 eth0 热点名 密码
</span></span></code></pre></div><p>  如果要兼顾防蹭网，则输入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo create_ap -c 信道 --mac-filter wlan0 eth0 热点名 密码
</span></span></code></pre></div><p>  我用的是信道10，以供参考。</p><h1 id=结语>结语</h1><p>  虽然看起来很多要做，但对于熟悉命令行的同学来说，这点命令也不算多。我按照这个实践过后已经成功了，如果你有任何问题，请联系我！我的邮箱为 <a href=mailto:201830260422@mail.scut.edu.cn>201830260422@mail.scut.edu.cn</a>。</p><p>  P.s. 树莓派配置完后，如果断开热点，再通过 WiFi 连接网络，可能会连接不了。我初步猜测可能是掩码的问题，但懒得研究怎么弄&mldr;于是采取了个简单粗暴的方法 <code>sudo ifconfig eth0 down</code>，然后就连上了。</p><p>  P.P.s. 3B 和 3B+ 我都试了弄热点，虽然没仔细测过，个人感觉在供电充足的情况下，3B+ 会比 3B 快一点。但由于 3B+ 需要 2.5A 电流（普通的充电器达不到），所以 3B 反而好一丢丢。</p><p>2019/5/20补充：访问不了网页端斗鱼的解决方案：挂VPN。（学校貌似禁了斗鱼）</p><p>2019/5/24补充：室友玩游戏的声音有点吵到了我&mldr;&mldr;各位弄热点前要想清楚</p><p>2019/6/5补充：最近时不时网络会中断，过几分钟后又自动恢复，不知道是什么原因。</p><p>2019/7/24补充：最新的 Raspbian Buster 系统好像有一些莫名奇妙的 bug，等我回校后试一下</p><p>2019/8/21补充：最新的Buster也一样支持，在大学城和五山都试过了</p><h1 id=未来的安排>未来的安排：</h1><ol><li><del>学校的有线网是支持ipv6的，希望能够让热点也支持ipv6</del>（弃坑）</li><li>树莓派的硬件实在不是作为路由器的料（但作为小型服务器还是挺好的），以后还是转到路由器+openwrt吧</li><li><del>富强</del>上♂网</li></ol></div></div></main><script src=https://tokinx.github.io/lately/lately.min.js></script>
<script>window.Lately&&Lately.init({target:".post-date"})</script></body></html>