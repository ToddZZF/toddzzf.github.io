<!doctype html><html lang=en><head><meta charset=utf-8><meta name=renderer content="webkit"><meta http-equiv=x-ua-compatible content="IE=Edge,chrome=1"><meta http-equiv=cache-control content="no-siteapp"><meta http-equiv=cache-control content="no-transform"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name=description content="(Experimental Design)"><link rel="shortcut icon" href=/images/favicon.png><link rel=apple-touch-icon href=/images/favicon.png><meta name=author content="map[]"><title>Todd's Blog | 重玩树莓派</title><link rel=stylesheet href=/css/style.css></head><body class="antialiased bg-primary"><div class="flex flex-col sm:flex-row w-full text-white"><div class="sm:fixed w-screen sm:w-4/12 lg:w-3/12 h-screen p-4 bg-secondary bg-cover bg-center" style=background-image:url(/images/bg.png)><div class="flex flex-col justify-center items-center space-y-3 w-full h-full text-center text-white"><div><img class="w-3/12 sm:w-4/12 h-auto aspect-square m-auto rounded-[50%]" src=/images/avatar.png alt=Todd></div><div><a class="text-3xl font-semibold hover:text-accent" href=/>Todd's Blog</a></div><div class=item-center><p class="text-lg font-medium">(Experimental Design)</p></div><div class=pt-5><ul class=text-3xl><li class="inline-block hover:text-accent"><a class=p-3 href=/><i class="fas fa-envelope"></i></a></li><li class="inline-block hover:text-accent"><a class=p-3 href=/about><i class="fab fa-youtube"></i></a></li><li class="inline-block hover:text-accent"><a class=p-3 href=https://github.com/ToddZZF><i class="fab fa-github"></i></a></li><li class="inline-block hover:text-accent"><a class=p-3 href=/about><i class="fab fa-weixin"></i></a></li></ul></div></div></div><div class="flex flex-col w-screen sm:w-8/12 lg:w-6/12 sm:ml-[33.3%] lg:ml-[25%] p-6 md:p-12 bg-primary"><div class="text-3xl font-semibold">重玩树莓派</div><div class="mb-4 text-base text-[#868E96]">Oct 26, 2021</div><div class="article relative"><h2 id=回顾>回顾</h2><p>  树莓派可以算是我的编程启蒙了，我的第一块树莓派3是高三时母亲买给我的，我在上面学习了Python，并编了一个安排班级座位表的程序。随后到了大一，我用树莓派在宿舍开WiFi，之后有一段时间用来折腾人工智能算法。可以说，树莓派是我最喜欢的玩具之一。</p><p>  为了不让它吃灰，我决定重新开始折腾树莓派，这次会偏重于Web端，我希望所有的东西都可以通过浏览器来设置，方便未来用平板进行访问。</p><p>  下面记录一下我的操作过程，方便未来查错。</p><h2 id=极值性能>极值性能</h2><p>  为了追求性能最大化，我采用SSD启动（参见：<a href=https://zhuanlan.zhihu.com/p/336932291>树莓派4 SSD 启动</a>），使用的系统是 <a href=https://github.com/openfans-community-offical/Debian-Pi-Aarch64/blob/master/README_zh.md>Debian-Pi-Aarch64</a></p><p>  但在试错阶段，依然采用 micro-SD 卡启动。</p><h2 id=服务>服务</h2><p>  账号大部分是：<code>pi</code>，密码一律是 <code>toddraspi</code>（which is short for todd&rsquo;s rasberry pi）</p><h3 id=端口概览>端口概览</h3><p>下面列出网页服务和对应的端口号。</p><table><thead><tr><th>端口</th><th>服务</th><th>账号</th></tr></thead><tbody><tr><td>3000</td><td>wikijs</td><td><a href=mailto:toddzzf@outlook.com>toddzzf@outlook.com</a></td></tr><tr><td>4200</td><td>WEB SSH</td><td>pi</td></tr><tr><td>8443</td><td>CecOS容器平台</td><td>admin</td></tr><tr><td>8096</td><td>jellyfin</td><td>pi</td></tr><tr><td>9090</td><td>Cockpit管理界面</td><td>pi</td></tr></tbody></table><h3 id=服务安装过程>服务安装过程</h3><h4 id=jellyfin>Jellyfin</h4><p>  直接根据官网的教程：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install apt-transport-https
</span></span><span style=display:flex><span>wget -O - https://repo.jellyfin.org/jellyfin_team.gpg.key | sudo apt-key add -
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;deb [arch=</span><span style=color:#66d9ef>$(</span> dpkg --print-architecture <span style=color:#66d9ef>)</span><span style=color:#e6db74>] https://repo.jellyfin.org/</span><span style=color:#66d9ef>$(</span> awk -F<span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#e6db74>&#39;/^ID=/{ print $NF }&#39;</span> /etc/os-release <span style=color:#66d9ef>)</span><span style=color:#e6db74> </span><span style=color:#66d9ef>$(</span> awk -F<span style=color:#e6db74>&#39;=&#39;</span> <span style=color:#e6db74>&#39;/^VERSION_CODENAME=/{ print $NF }&#39;</span> /etc/os-release <span style=color:#66d9ef>)</span><span style=color:#e6db74> main&#34;</span> | sudo tee /etc/apt/sources.list.d/jellyfin.list
</span></span><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install jellyfin
</span></span></code></pre></div><p>  安装完提示找不到 jellyfin-web，需要创建软链接：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ln -s /usr/share/jellyfin/web/ /usr/lib/jellyfin/bin/jellyfin-web
</span></span></code></pre></div><p>  但在树莓派上，硬件解码是不可能的，所以这个只能当作一乐。</p><h4 id=wikijs>Wikijs</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name<span style=color:#f92672>=</span>wikijs <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e PUID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e PGID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e TZ<span style=color:#f92672>=</span>Asia/Shanghai <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 3000:3000 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v ~/Docker/wikijs/config:/config <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v ~/Docker/wikijs/data:/data <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --restart unless-stopped <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  lscr.io/linuxserver/wikijs <span style=color:#75715e>#or linuxserver/wikijs</span>
</span></span></code></pre></div><p>  然后访问 ip:3000，根据指引注册管理员账号。</p><h4 id=code-server>code-server</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name<span style=color:#f92672>=</span>code-server <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e PUID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e PGID<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e TZ<span style=color:#f92672>=</span>Asia/Shanghai <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e PASSWORD<span style=color:#f92672>=</span>toddraspi <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e SUDO_PASSWORD<span style=color:#f92672>=</span>toddraspi <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 8888:8443 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v ~/Docker/code-server/config:/config <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --restart unless-stopped <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  lscr.io/linuxserver/code-server <span style=color:#75715e>#or linuxserver/code-server</span>
</span></span></code></pre></div><p>  然后访问 ip:8888，开始安装一些编程语言。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install wget
</span></span></code></pre></div><h5 id=go>go</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://studygolang.com/dl/golang/go1.17.2.linux-arm64.tar.gz -O go.tar.gz
</span></span></code></pre></div><p>大概率会提示 <code>wget: unable to resolve host address ‘dl.google.com’</code>。可以多试两次。实在不行，就通过 ssh 上传到宿主机的 <code>~/Docker/code-server/config/workspace</code> 目录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 解压golang到 /usr/local 下</span>
</span></span><span style=display:flex><span>sudo rm -rf /usr/local/go <span style=color:#f92672>&amp;&amp;</span> sudo tar -C /usr/local -xzf go.tar.gz
</span></span><span style=display:flex><span><span style=color:#75715e># 将golang添加到PATH环境变量</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 添加下面这几行到 $HOME/.profile 或 /etc/profile (for a system-wide installation)</span>
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$PATH:/usr/local/go/bin
</span></span><span style=display:flex><span>export GO111MODULE<span style=color:#f92672>=</span>on
</span></span><span style=display:flex><span>export GOPROXY<span style=color:#f92672>=</span>https://goproxy.cn
</span></span><span style=display:flex><span><span style=color:#75715e># souce 一下环境变量</span>
</span></span><span style=display:flex><span>source /etc/profile
</span></span><span style=display:flex><span><span style=color:#75715e># 验证安装成功与否</span>
</span></span><span style=display:flex><span>go version
</span></span><span style=display:flex><span>go env
</span></span></code></pre></div><p>相应地，需要在 vscode 中安装 golang 官方的插件 <code>Go</code>，但是在安装完后，根据插件提示安装一系列时 go tools 出现安装失败的问题：上面设置的 <code>GOPROXY</code> 不起作用，怀疑是 docker 内的 bash 运行时不会读取 <code>/etc/profile</code>。于是尝试在创建 docker 就将该环境变量用 <code>-e</code> 的方式传入，发现安装成功。</p><h5 id=cc>c/c++</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install cpp gcc cmake make
</span></span></code></pre></div><h5 id=python>python</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install python3.8
</span></span></code></pre></div></div><hr class=my-6><footer class="text-base text-[#868E96]"><small>&copy; 0001 - 2022 <a href=https://toddzzf.github.io class="underline hover:text-accent">Todd</a>. All rights reserved.
Powered by <a href=https://gohugo.io/ class="underline hover:text-accent">Hugo</a> & <a href=https://github.com/vszhub/not-pure-poole class="underline hover:text-accent">Not Pure Poole</a>.</small></footer></div></div></body><link href=https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/css/all.min.css rel=stylesheet><link href=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css rel=stylesheet><script src=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/highlight.min.js></script>
<script>hljs.highlightAll()</script></html>