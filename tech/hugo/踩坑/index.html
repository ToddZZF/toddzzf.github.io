<!doctype html><html lang=en><head><meta charset=utf-8><meta name=renderer content="webkit"><meta http-equiv=x-ua-compatible content="IE=Edge,chrome=1"><meta http-equiv=cache-control content="no-siteapp"><meta http-equiv=cache-control content="no-transform"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name=description content="(Experimental Design)"><link rel="shortcut icon" href=/images/favicon.png><link rel=apple-touch-icon href=/images/favicon.png><meta name=author content="map[]"><title>Todd's Blog | 踩坑</title><link rel=stylesheet href=/css/style.css></head><body class="antialiased bg-primary"><div class="flex flex-col sm:flex-row w-full text-white"><div class="sm:fixed w-screen sm:w-4/12 lg:w-3/12 h-screen p-4 bg-secondary bg-cover bg-center" style=background-image:url(/images/bg.png)><div class="flex flex-col justify-center items-center space-y-3 w-full h-full text-center text-white"><div><img class="w-3/12 sm:w-4/12 h-auto aspect-square m-auto rounded-[50%]" src=/images/avatar.png alt=Todd></div><div><a class="text-3xl font-semibold hover:text-accent" href=/>Todd's Blog</a></div><div class=item-center><p class="text-lg font-medium">(Experimental Design)</p></div><div class=pt-5><ul class=text-3xl><li class="inline-block hover:text-accent"><a class=p-3 href=/><i class="fas fa-envelope"></i></a></li><li class="inline-block hover:text-accent"><a class=p-3 href=/about><i class="fab fa-youtube"></i></a></li><li class="inline-block hover:text-accent"><a class=p-3 href=https://github.com/ToddZZF><i class="fab fa-github"></i></a></li><li class="inline-block hover:text-accent"><a class=p-3 href=/about><i class="fab fa-weixin"></i></a></li></ul></div></div></div><div class="flex flex-col w-screen sm:w-8/12 lg:w-6/12 sm:ml-[33.3%] lg:ml-[25%] p-6 md:p-12 bg-primary"><div class="text-3xl font-semibold">踩坑</div><div class="mb-4 text-base text-[#868E96]">May 31, 2022</div><div class="article relative"><h2 id=summary>Summary</h2><blockquote><p>存疑，好像 summary 不起作用</p></blockquote><p>根据 <a href=https://gohugo.io/content-management/summaries/>Content Summaries | Hugo</a>，Hugo 会按顺序从以下三个位置找 Summary：</p><ol><li>如果文中出现了 <code>&lt;!--more--></code>，则取第一次 <code>&lt;!--more--></code> 分隔前的内容作为摘要</li><li>如果 front matter 中有 <code>summary</code> 字段，则取该字段作为摘要</li><li>如果都无则根据设置从文中摘取前n个字符作为摘要。</li></ol><p>因此，如果设置了 <code>summary</code> 字段，就没必要再加 <code>&lt;!--more--></code>，加了反而 summary 无效。但是，如果 summary 字段为空，则等同于没有设置。</p><h2 id=mathjax>Mathjax</h2><p>本来打算直接通过 HTML 引入 Mathjax（以下代码参照 <a href=https://note.qidong.name/2018/03/hugo-mathjax/>在Hugo中使用MathJax</a>）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>{{ if .Params.math }}
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>MathJax</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tex</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>inlineMath</span><span style=color:#f92672>:</span> [[<span style=color:#e6db74>&#34;$&#34;</span>, <span style=color:#e6db74>&#34;$&#34;</span>]],
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>displayMath</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>      [<span style=color:#e6db74>&#34;$$&#34;</span>, <span style=color:#e6db74>&#34;$$&#34;</span>],
</span></span><span style=display:flex><span>      [<span style=color:#e6db74>&#34;\[\[&#34;</span>, <span style=color:#e6db74>&#34;\]\]&#34;</span>],
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>svg</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fontCache</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;global&#34;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://polyfill.io/v3/polyfill.min.js?features=es6&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;MathJax-script&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>async</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js&#34;</span>
</span></span><span style=display:flex><span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>{{ end }}
</span></span></code></pre></div><p>但是 Hugo 所使用的 goldmark 会将 <code>\\</code> 转义为 <code>\</code>，也就是说我们需要使用：<code>\\\\</code>，十分不美观。</p><p>目前找到的解决方法有两个：</p><ol><li>改底层代码，重新编译 hugo.exe：<a href=https://github.com/ToddZZF/Hugo-Mathjax>https://github.com/ToddZZF/Hugo-Mathjax</a>，已有的主题不用做任何修改</li><li>用正则表达式去替换：<a href=https://github.com/wzdlc1996/HugoSource>https://github.com/wzdlc1996/HugoSource</a>，需要将 <code>{{ .Content }}</code> 替换为下面这个 partial</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>layouts</span><span style=color:#f92672>/</span><span style=color:#a6e22e>partials</span><span style=color:#f92672>/</span><span style=color:#a6e22e>escapeMathjaxEq</span>.<span style=color:#a6e22e>html</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rawcont</span> <span style=color:#f92672>:=</span> .<span style=color:#a6e22e>RawContent</span> }}
</span></span><span style=display:flex><span>{{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> <span style=color:#f92672>:=</span> .<span style=color:#a6e22e>Content</span> }}
</span></span><span style=display:flex><span>{{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>niceBlockEqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>findRE</span> <span style=color:#e6db74>&#34;[$][$][\\w\\W]+?[$][$]&#34;</span> .<span style=color:#a6e22e>RawContent</span> }}
</span></span><span style=display:flex><span>{{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>badBlockEqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>findRE</span> <span style=color:#e6db74>&#34;[$][$][\\w\\W]+?[$][$]&#34;</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> }}
</span></span><span style=display:flex><span>{{ <span style=color:#66d9ef>range</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>ind</span>, <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>niceBlockEqs</span> }}
</span></span><span style=display:flex><span>    {{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> = <span style=color:#a6e22e>replace</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> (<span style=color:#a6e22e>index</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>badBlockEqs</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>ind</span>) <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>val</span> }}
</span></span><span style=display:flex><span>{{ <span style=color:#a6e22e>end</span> }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> = <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> | <span style=color:#a6e22e>replaceRE</span> <span style=color:#e6db74>&#34;([^\\$])([$][^\\$]+?[$])([^\\$])&#34;</span> <span style=color:#e6db74>&#34;$1 $2 $3&#34;</span> }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>niceInlineEqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>findRE</span> <span style=color:#e6db74>&#34;[^\\$][$][^\\$]+?[$][^\\$]&#34;</span> .<span style=color:#a6e22e>RawContent</span> }}
</span></span><span style=display:flex><span>{{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>badInlineEqs</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>findRE</span> <span style=color:#e6db74>&#34; [$][^\\$]+?[$] &#34;</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> }}
</span></span><span style=display:flex><span>{{ <span style=color:#66d9ef>range</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>ind</span>, <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>val</span> <span style=color:#f92672>:=</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>niceInlineEqs</span> }}
</span></span><span style=display:flex><span>    {{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>newval</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>replaceRE</span> <span style=color:#e6db74>&#34;([$][^\\$]+?[$])&#34;</span> <span style=color:#e6db74>&#34; $1 &#34;</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>val</span> }}
</span></span><span style=display:flex><span>    {{ <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> = <span style=color:#a6e22e>replace</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> (<span style=color:#a6e22e>index</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>badInlineEqs</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>ind</span>) (<span style=color:#a6e22e>substr</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>newval</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) }}
</span></span><span style=display:flex><span>{{ <span style=color:#a6e22e>end</span> }}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{{<span style=color:#f92672>-</span> <span style=color:#960050;background-color:#1e0010>$</span><span style=color:#a6e22e>rddcont</span> | <span style=color:#a6e22e>safeHTML</span> <span style=color:#f92672>-</span>}}
</span></span></code></pre></div></div><hr class=my-6><footer class="text-base text-[#868E96]"><small>&copy; 0001 - 2022 <a href=https://toddzzf.github.io class="underline hover:text-accent">Todd</a>. All rights reserved.
Powered by <a href=https://gohugo.io/ class="underline hover:text-accent">Hugo</a> & <a href=https://github.com/vszhub/not-pure-poole class="underline hover:text-accent">Not Pure Poole</a>.</small></footer></div></div></body><link href=https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.3/css/all.min.css rel=stylesheet><link href=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/styles/github-dark-dimmed.min.css rel=stylesheet><script src=https://cdn.bootcdn.net/ajax/libs/highlight.js/11.4.0/highlight.min.js></script>
<script>hljs.highlightAll()</script></html>