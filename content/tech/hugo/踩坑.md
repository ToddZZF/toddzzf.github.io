---
title: "踩坑"
date: 2022-05-31T19:40:21+08:00
summary: " "
---

<!--more-->

## Summary

> 存疑，好像 summary 不起作用

根据 [Content Summaries | Hugo](https://gohugo.io/content-management/summaries/)，Hugo 会按顺序从以下三个位置找 Summary：

1. 如果文中出现了 `<!--more-->`，则取第一次 `<!--more-->` 分隔前的内容作为摘要
2. 如果 front matter 中有 `summary` 字段，则取该字段作为摘要
3. 如果都无则根据设置从文中摘取前n个字符作为摘要。

因此，如果设置了 `summary` 字段，就没必要再加 `<!--more-->`，加了反而 summary 无效。但是，如果 summary 字段为空，则等同于没有设置。

## Mathjax

本来打算直接通过 HTML 引入 Mathjax（以下代码参照 [在Hugo中使用MathJax](https://note.qidong.name/2018/03/hugo-mathjax/)）：

```html
{{ if .Params.math }}
<script>
  MathJax = {
    tex: {
      inlineMath: [["$", "$"]],
    },
    displayMath: [
      ["$$", "$$"],
      ["\[\[", "\]\]"],
    ],
    svg: {
      fontCache: "global",
    },
  };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script>
{{ end }}
```

但是 Hugo 所使用的 goldmark 会将 `\\` 转义为 `\`，也就是说我们需要使用：`\\\\`，十分不美观。

目前找到的解决方法有两个：

1. 改底层代码，重新编译 hugo.exe：<https://github.com/ToddZZF/Hugo-Mathjax>，已有的主题不用做任何修改
2. 用正则表达式去替换：<https://github.com/wzdlc1996/HugoSource>，需要将 `{{ .Content }}` 替换为下面这个 partial

```go
layouts/partials/escapeMathjaxEq.html

{{ $rawcont := .RawContent }}
{{ $rddcont := .Content }}
{{ $niceBlockEqs := findRE "[$][$][\\w\\W]+?[$][$]" .RawContent }}
{{ $badBlockEqs := findRE "[$][$][\\w\\W]+?[$][$]" $rddcont }}
{{ range $ind, $val := $niceBlockEqs }}
    {{ $rddcont = replace $rddcont (index $badBlockEqs $ind) $val }}
{{ end }}

{{ $rddcont = $rddcont | replaceRE "([^\\$])([$][^\\$]+?[$])([^\\$])" "$1 $2 $3" }}



{{ $niceInlineEqs := findRE "[^\\$][$][^\\$]+?[$][^\\$]" .RawContent }}
{{ $badInlineEqs := findRE " [$][^\\$]+?[$] " $rddcont }}
{{ range $ind, $val := $niceInlineEqs }}
    {{ $newval := replaceRE "([$][^\\$]+?[$])" " $1 " $val }}
    {{ $rddcont = replace $rddcont (index $badInlineEqs $ind) (substr $newval 1 -1) }}
{{ end }}

{{- $rddcont | safeHTML -}}
```