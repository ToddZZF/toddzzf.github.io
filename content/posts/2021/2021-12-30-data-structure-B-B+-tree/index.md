---
layout: post
title: 数据结构：B&B+树
date: 2021-12-30 15:22:00 +0800
category: work
image: fluttershy.png
icon: note
summary: B&B+树是2-3树的扩展
mathjax: true
---

## B树

### 基本概念

B树中，结点中的孩子结点个数的最大值为B树的**阶 m**，并满足如下一些性质：

1. 每个结点最多有 $m$ 个子树，最少有 $\lceil m/2 \rceil$ 个分支。特殊的，根结点若不是叶子，则最少有 2 个分支
2. 若一个结点有 $n-1$ 个关键字，则有 $n$ 个分支。且关键字递增排列。关键字和孩子结点的关系如下：

    ```
      k1  k2  k3  ...  kn
     /  |   |   |        \
    p0  p1  p2  p3  ...  pn
    ```
   其中，$n$ 为关键字的个数，ki 为关键字且满足ki<ki+1，pi为孩子结点的指针且所指结点的关键字满足 ki<pi<ki+1
3. 根据1和2，可知结点最多有 $m-1$ 个关键字，最少有 $\lceil m/2 \rceil-1$ 个关键字。（特殊的，根可以只有1个关键字）
4. 叶子结点处于同一层，可以用空指针表示，是查找失败到达的位置。（也就是叶子结点全都是空结点）
5. （根据上一条）B树是平衡的

### B树的查找

从根结点出发，

1. 先查找结点内的关键字
2. 若找不到，则在对应范围内查找

### B树的插入

1. 定位：找到最低层中的某个非叶结点
2. 插入：若插入后，关键字个数大于 $m-1$（即子树大于 $m$），则分裂，否则完成插入。
3. 分裂：以 $\lceil m \rceil$ 关键字进行划分，分为两个子结点，然后中间 $\lceil m \rceil$ 关键字则插入到父结点。若父节点超出 $m-1$，则继续分裂。

这个和2-3树是类似的。


### B树的建立

1. 首先确定树的阶数
2. 先经可能地将根填满到 $m-1$
3. 然后不断地插入

示例：5阶树

```
{1,2,6,7,11,4,8,13,10,5,17,9,16,20,3,12,14,18,19,15}
```

```
{11,4,8,13,10,5,17,9,16,20,3,12,14,18,19,15}

1,2,6,7
```

```
{4,8,13,10,5,17,9,16,20,3,12,14,18,19,15}

   6
  /  \
1,2  7,11
```

```
{10,5,17,9,16,20,3,12,14,18,19,15}

     6
   /   \
1,2,4  7,8,11,13
```

```
{5,17,9,16,20,3,12,14,18,19,15}

     6, 10
   /   \   \
1,2,4  7,8  11,13
```

```
{20,3,12,14,18,19,15}

     6,  10
   /   \      \
1,2,4,5  7,8,9  11,13,16,17
```

```
{3,12,14,18,19,15}

     6,   10,    16 
   /   \      \      \
1,2,4,5  7,8,9  11,13  17,20
```

```
{12,14,18,19,15}

    3,   6,   10,    16 
   /   \    \      \      \
1,2    4,5  7,8,9  11,13  17,20
```

```
{15}

    3,   6,   10,      16 
   /   \    \       \          \
1,2    4,5  7,8,9  11,12,13,14  17,18,19,20
```

```
            10
          /      \
    3,   6       13,   16 
   /   \    \      \     \      \
1,2    4,5  7,8,9  11,12  14,15  17,18,19,20
```


### B树的删除

若删除的是非终端结点（即不是最低的非空结点），可以用前驱或后继代替，从而转化为删除终端结点的情况。

若删除的是终端结点，

1. 删除后仍满足关键字个数大于 $\lceil m/2 \rceil-1$，则完成
2. 反正，则向兄弟结点借，节的过程是：兄弟结点的最大/小值先代替父节点的一个关键字，再将父节点的关键字移到删除结点
   ```
   删除65

      60, 71
    /    |   \
   ...  65  74,86

      60, 71
    /    |   \
   ...  空  86

      60, 74
    /    |   \
   ...  71  86
   ```
3. 若兄弟结点不够借（即关键字都刚好是 $\lceil m/2 \rceil-1$），则将被删结点、父结点中的关键字、兄弟结点组合成新结点（此时为 $m-1$ 个关键字）。删除后，父节点的关键字个数少1，若
   1. 父节点是根，且减少为0，则新结点成为新的根
   2. 